{% extends "base.html" %}
{% load static %}

{% block title %}Home - To Do App{% endblock %}

{% block content %}
<link rel="stylesheet" type="text/css" href="{% static 'css/home.css' %}">

<div class="container text-center">
    {% if user.is_authenticated %}
        <h1>Welcome back, {{ user.username }}!</h1>
        <p class="home-subtitle">
            Ready to organize your day?
        </p>

        <div class="card task-card">
            <h3>Your Tasks</h3>

            {% if tasks %}
                <ul class="task-list">
                    {% for task in tasks %}
                        <li class="task-item {% if task.completed %}completed{% endif %}">
                            {# Status badge moved to top level for absolute positioning #}
                            <span class="task-status-badge {% if task.completed %}completed{% else %}pending{% endif %}">
                                {% if task.completed %}‚úì Done{% else %}Pending{% endif %}
                            </span>

                            <div class="task-item-content">
                                <div class="task-item-text">
                                    {# Checkbox form for quick status toggle #}
                                    <form method="post" action="{% url 'task_toggle' task.pk %}" class="task-toggle-form">
                                        {% csrf_token %}
                                        <input
                                            type="checkbox"
                                            id="task-{{ task.pk }}"
                                            class="task-checkbox"
                                            {% if task.completed %}checked{% endif %}
                                            onchange="this.form.submit()"
                                        >
                                        <label for="task-{{ task.pk }}" class="task-checkbox-label">
                                            <h4 class="task-item-title {% if task.completed %}completed{% endif %}">
                                                {{ task.title }}
                                            </h4>
                                        </label>
                                    </form>

                                    {% if task.description %}
                                        <p class="task-item-description">
                                            {{ task.description }}
                                        </p>
                                    {% endif %}
                                    <small class="task-item-date">
                                        Created: {{ task.created_at|date:"M d, Y, h:i" }}
                                    </small>
                                </div>
                                {# Action buttons wrapped in new group container #}
                                <div class="task-item-actions">
                                    <div class="task-actions-group">
                                        {# Edit button with task.pk (primary key) passed to URL #}
                                        {# {% url 'task_update' task.pk %} generates: /tasks/5/edit/ #}
                                        <a href="{% url 'task_update' task.pk %}" class="task-edit-btn">‚úèÔ∏è Edit</a>
                                        <a href="{% url 'task_delete' task.pk %}" class="task-delete-btn">üóëÔ∏è Delete</a>
                                    </div>
                                </div>
                            </div>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="empty-tasks-message">
                    You haven't created any tasks yet. Start adding tasks to stay productive!
                </p>
            {% endif %}

            <a href="{% url 'task_create' %}" class="btn mt-2">
                ‚úì Add New Task
            </a>
        </div>

    {% else %}
        <h1>Organize Your Life</h1>
        <p class="home-subtitle">
            A simple and elegant way to manage your tasks
        </p>

        <div class="home-cta">
            <a href="{% url 'signup' %}" class="btn">Get Started</a>
            <a href="{% url 'login' %}" class="btn btn-secondary">Login</a>
        </div>

        <div class="card features-card">
            <h3>Why To Do App?</h3>
            <ul class="features-list">
                <li>‚úì Simple and intuitive interface</li>
                <li>‚úì Stay organized and productive</li>
                <li>‚úì Access your tasks anywhere</li>
            </ul>
        </div>
    {% endif %}
</div>
{% endblock %}